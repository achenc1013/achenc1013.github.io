"use strict";(self.webpackChunkblog=self.webpackChunkblog||[]).push([[960],{6262:(i,s)=>{s.A=(i,s)=>{const e=i.__vccOpts||i;for(const[i,a]of s)e[i]=a;return e}},3001:(i,s,e)=>{e.r(s),e.d(s,{comp:()=>t,data:()=>n});var a=e(641);const l={},t=(0,e(6262).A)(l,[["render",function(i,s){return(0,a.uX)(),(0,a.CE)("div",null,[s[0]||(s[0]=(0,a.Lk)("h1",{id:"linux应急响应日志排查步骤",tabindex:"-1"},[(0,a.Lk)("a",{class:"header-anchor",href:"#linux应急响应日志排查步骤"},[(0,a.Lk)("span",null,"Linux应急响应日志排查步骤")])],-1)),s[1]||(s[1]=(0,a.Lk)("ol",null,[(0,a.Lk)("li",null,"确定排查时间段：根据应急响应的具体情况，确定需要排查的时间范围，例如从发现问题的时间点往前追溯一定的时间。"),(0,a.Lk)("li",null,"选择相关日志文件：根据排查目标，选择需要查看的日志文件。"),(0,a.Lk)("li",null,"使用工具进行排查：运用上述的排查工具，在日志文件中搜索关键信息、分析日志内容。"),(0,a.Lk)("li",null,"整理和总结：将排查到的可疑信息进行整理和总结，分析事件的可能原因和影响范围。")],-1)),s[2]||(s[2]=(0,a.Lk)("hr",null,null,-1)),(0,a.Q3)(" more "),s[3]||(s[3]=(0,a.Fv)('<h2 id="日志文件是记录系统运行信息的文件-linux系统系统内记载很多不同类型的日志-例如" tabindex="-1"><a class="header-anchor" href="#日志文件是记录系统运行信息的文件-linux系统系统内记载很多不同类型的日志-例如"><span>日志文件是记录系统运行信息的文件，Linux系统系统内记载很多不同类型的日志，例如：</span></a></h2><ul><li>Linux内核消息</li><li>登入事件</li><li>程序错误日志</li><li>软件安装信息</li></ul><p><strong>以上日志内记录系统内一些关键的信息，通过这些日志内记录的信息，可以帮助安全人员寻找到攻击者蛛丝马迹。作者整理了以下日志常见信息：</strong></p><p><code>/var/log/dmesg</code> 内核的一些信息。</p><p><code>/var/log/auth.log</code> 此文件中包含系统授权信息，以及用户登录和使用的身份验证机制。</p><p><code>/var/1og/boot.log</code> 包含系统启动时记录的信息</p><p><code>/var/log/daemon.log</code> 正在运行的各种系统后台守护程序将信息记录到此文件中。</p><p><code>/var/1og/kern.log</code> 包含内核记录的信息。有助于解决定制内核的故障。</p><p><code>/var/log/lastlog</code> 显示所有用户的最近登录信息。这不是ascii文件。管理员可以使用lastlog命令查看此文件的内容。</p><p><code>/var/log/maillog</code> 和 <code>/var/log/mail.log</code> 记录系统上运行的邮件服务器的信息。例如，sendmail将有关所有已发送项目的信息记录到此文件中。</p><p><code>/var/log/user.log</code> 包含有关所有用户级日志的信息。</p><p><code>/var/1og/Xorg.x.log</code> 将来自x服务器的消息记录到此文件。</p><p><code>/var/log/btmp</code> 此文件包含有关失败登录尝试的信息。使用最后一个命令查看btmp文件。例如，<code>last-f/var/log/btmp |more</code></p><p><code>/var/log/yum.log</code> 包含使用yum安装包时记录的信息。在删除具有依赖项的包时，可以引l用此文件。</p><p><code>/var/log/cron</code> 每当cron守护程序（或anacron）启动cron作业时，它都会将有关cron作业的信息记录在该文件中。</p><p><code>/var/log/secure</code> 包含与身份验证和授权权限相关的信息。例如，sshd在这里记录所有消息，包括登录失败。</p><p><code>/var/log/wtmp-wtmp</code> 文件记录所有登录和注销。</p><p><code>/var/1og/utmp-utmp</code> 文件允许您发现有关当前使用系统的用户的信息。</p><p><code>/var/log/faillog</code> 包含失败的用户登录尝试。使用faillog命令显示此文件的内容。</p><p><code>/var/1og/httpd/</code> 包含apacheweb服务器access_log和error_log以及相关的虚拟主机日志（如果设置为在此处记录）。</p><p><code>/var/1og/apache2</code> 包含apache web服务器access_log和error_log以及相关的虚拟主机日志（如果设置为在此处记录）。</p><p><code>/var/log/conman/-conman</code> 客户端的日志文件。conman连接由conmand守护进程管理的远程控制台。</p><p><code>/var/log/mail/</code>此子目录包含来自邮件服务器的其他日志。例如，sendmail将收集的邮件统计信息存储在<code>/var/log/mail/statistics</code> 文件中。</p><p><code>/var/log/audit/</code> 包含由Linux审核守护程序(auditd)存储的日志信息。</p><p><code>/var/log/settroubleshoot/SELinux</code> 使用settroublishootd (SE TroubleshootDaemon)来通知文件安全上下文中的问题，并将这些信息记录在此日志文件中。</p><p><code>/var/log/samba/</code> 包含samba存储的日志信息，用于将Windows连接到Linux。</p><p><code>/var/log/sa/</code> 包含sysstat包收集的每日sar文件。</p><h2 id="登入验证日志" tabindex="-1"><a class="header-anchor" href="#登入验证日志"><span>登入验证日志</span></a></h2><ol><li>不知道日志的每一行是做什么的，去搜索</li><li>既然是登入验证肯定会有成功和失败，那么什么状态是成功或失败</li><li>除成功失败外是不是包含其它信息，如：用户名、登入来源IP地址</li></ol><p><strong>经过以上的几点思考，我在网上找到文章和命令</strong></p><h3 id="登陆失败次数" tabindex="-1"><a class="header-anchor" href="#登陆失败次数"><span>登陆失败次数</span></a></h3><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> grep</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;Failed password&quot;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> auth.log</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">wc</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -1</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="登陆成功日志" tabindex="-1"><a class="header-anchor" href="#登陆成功日志"><span>登陆成功日志</span></a></h3><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> grep</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;password&quot;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> auth.log</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">grep</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -v</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Failed</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">grep</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -V</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Invalid</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="统计攻击者ip" tabindex="-1"><a class="header-anchor" href="#统计攻击者ip"><span>统计攻击者IP</span></a></h3><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> awk</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;{if($6 == &quot;Failed&quot; &amp;&amp; $7 == &quot;password&quot;){if($9 == &quot;invalid&quot;){ips[$13]++; users[$11]++} else fusers[$9]++; ips[$11]++}}} END{for(ip in ips){printip,ips[ip]}}&#39;auth.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">*</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">|</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">wc</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -1</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="攻击次数排列-由高到低" tabindex="-1"><a class="header-anchor" href="#攻击次数排列-由高到低"><span>攻击次数排列，由高到低</span></a></h3><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> awk</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;{if($6==&quot;Failed&quot;&amp;&amp;$7==&quot;password&quot;){if($9==&#39;invalid&quot;){ips[</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$13</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">]++; users[</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$11</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">]++}e1sefusers[</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">$9</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">]++; ips[</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$11</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">]++}}}END{for(ip in ips){printip,ips[ip]}}&#39;auth.* | sort -k2 -rn | head</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><blockquote><p>41.214.134.201 18358</p><p>189.217.194.155 9994</p><p>218.39.177.111 4713</p><p>120.48.13.143 2179</p><p>36.138.66.177 1448</p><p>139.162.114.41 861</p><p>104.248.94.181 756</p><p>188.166.57.168 431</p><p>141.94.110.90 347</p><p>23.224.143.15 307</p><p><strong>最后是统计的次数</strong></p></blockquote>',39))])}]]),n=JSON.parse('{"path":"/posts/%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94/2025-02-19.html","title":"Linux系统日志排查","lang":"zh-CN","frontmatter":{"title":"Linux系统日志排查","cover":null,"icon":"pen-to-square","date":"2025-02-19T00:00:00.000Z","category":["Linux应急响应"],"tag":["系统日志","应急响应"],"star":false,"sticky":false,"description":"确定排查时间段：根据应急响应的具体情况，确定需要排查的时间范围，例如从发现问题的时间点往前追溯一定的时间。 选择相关日志文件：根据排查目标，选择需要查看的日志文件。 使用工具进行排查：运用上述的排查工具，在日志文件中搜索关键信息、分析日志内容。 整理和总结：将排查到的可疑信息进行整理和总结，分析事件的可能原因和影响范围。","head":[["meta",{"property":"og:url","content":"https://mister-hope.github.io/posts/%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94/2025-02-19.html"}],["meta",{"property":"og:site_name","content":"云晞科技"}],["meta",{"property":"og:title","content":"Linux系统日志排查"}],["meta",{"property":"og:description","content":"确定排查时间段：根据应急响应的具体情况，确定需要排查的时间范围，例如从发现问题的时间点往前追溯一定的时间。 选择相关日志文件：根据排查目标，选择需要查看的日志文件。 使用工具进行排查：运用上述的排查工具，在日志文件中搜索关键信息、分析日志内容。 整理和总结：将排查到的可疑信息进行整理和总结，分析事件的可能原因和影响范围。"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2025-02-19T15:51:11.000Z"}],["meta",{"property":"article:tag","content":"系统日志"}],["meta",{"property":"article:tag","content":"应急响应"}],["meta",{"property":"article:published_time","content":"2025-02-19T00:00:00.000Z"}],["meta",{"property":"article:modified_time","content":"2025-02-19T15:51:11.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Linux系统日志排查\\",\\"image\\":[\\"\\"],\\"datePublished\\":\\"2025-02-19T00:00:00.000Z\\",\\"dateModified\\":\\"2025-02-19T15:51:11.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Lucifrix\\",\\"url\\":\\"https://mister-hope.com\\"}]}"]]},"headers":[{"level":2,"title":"日志文件是记录系统运行信息的文件，Linux系统系统内记载很多不同类型的日志，例如：","slug":"日志文件是记录系统运行信息的文件-linux系统系统内记载很多不同类型的日志-例如","link":"#日志文件是记录系统运行信息的文件-linux系统系统内记载很多不同类型的日志-例如","children":[]},{"level":2,"title":"登入验证日志","slug":"登入验证日志","link":"#登入验证日志","children":[{"level":3,"title":"登陆失败次数","slug":"登陆失败次数","link":"#登陆失败次数","children":[]},{"level":3,"title":"登陆成功日志","slug":"登陆成功日志","link":"#登陆成功日志","children":[]},{"level":3,"title":"统计攻击者IP","slug":"统计攻击者ip","link":"#统计攻击者ip","children":[]},{"level":3,"title":"攻击次数排列，由高到低","slug":"攻击次数排列-由高到低","link":"#攻击次数排列-由高到低","children":[]}]}],"git":{"createdTime":1739979858000,"updatedTime":1739980271000,"contributors":[{"name":"achenc1013","username":"achenc1013","email":"1013199991@qq.com","commits":2,"url":"https://github.com/achenc1013"}]},"readingTime":{"minutes":3.92,"words":1176},"filePathRelative":"posts/应急响应/2025-02-19.md","localizedDate":"2025年2月19日","excerpt":"\\n<ol>\\n<li>确定排查时间段：根据应急响应的具体情况，确定需要排查的时间范围，例如从发现问题的时间点往前追溯一定的时间。</li>\\n<li>选择相关日志文件：根据排查目标，选择需要查看的日志文件。</li>\\n<li>使用工具进行排查：运用上述的排查工具，在日志文件中搜索关键信息、分析日志内容。</li>\\n<li>整理和总结：将排查到的可疑信息进行整理和总结，分析事件的可能原因和影响范围。</li>\\n</ol>\\n<hr>\\n","autoDesc":true}')}}]);